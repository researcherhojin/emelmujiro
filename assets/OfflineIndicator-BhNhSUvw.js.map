{"version":3,"file":"OfflineIndicator-BhNhSUvw.js","sources":["../../src/components/common/OfflineIndicator.tsx"],"sourcesContent":["import React, { useState, useEffect, memo } from 'react';\nimport { WifiOff, Wifi, AlertCircle, RefreshCw } from 'lucide-react';\n\ninterface OfflineIndicatorState {\n  isOnline: boolean;\n  syncStatus: 'idle' | 'syncing' | 'success' | 'error';\n  pendingRequests: number;\n}\n\nconst OfflineIndicator: React.FC = memo(() => {\n  const [state, setState] = useState<OfflineIndicatorState>({\n    isOnline: navigator.onLine,\n    syncStatus: 'idle',\n    pendingRequests: 0,\n  });\n  const [showIndicator, setShowIndicator] = useState<boolean>(\n    !navigator.onLine\n  );\n\n  useEffect(() => {\n    const handleOnline = () => {\n      setState((prev) => ({ ...prev, isOnline: true, syncStatus: 'syncing' }));\n      setShowIndicator(true);\n\n      // Simulate sync process\n      setTimeout(() => {\n        setState((prev) => ({\n          ...prev,\n          syncStatus: 'success',\n          pendingRequests: 0,\n        }));\n        setTimeout(() => {\n          setState((prev) => ({ ...prev, syncStatus: 'idle' }));\n          setShowIndicator(false);\n        }, 2000);\n      }, 1500);\n    };\n\n    const handleOffline = () => {\n      setState((prev) => ({\n        ...prev,\n        isOnline: false,\n        syncStatus: 'idle',\n        pendingRequests: prev.pendingRequests + 1,\n      }));\n      setShowIndicator(true);\n    };\n\n    // Service worker message handler for enhanced sync status\n    const handleServiceWorkerMessage = (event: MessageEvent) => {\n      const { type, data } = event.data || {};\n\n      switch (type) {\n        case 'NETWORK_STATUS':\n          if (data?.online) {\n            handleOnline();\n          } else {\n            handleOffline();\n          }\n          break;\n        case 'SYNC_STATUS':\n          setState((prev) => ({\n            ...prev,\n            syncStatus: data?.status || 'idle',\n            pendingRequests: data?.pendingCount || 0,\n          }));\n          break;\n        case 'BACKGROUND_SYNC_COMPLETE':\n          setState((prev) => ({\n            ...prev,\n            syncStatus: 'success',\n            pendingRequests: Math.max(0, prev.pendingRequests - 1),\n          }));\n          setTimeout(() => {\n            setState((prev) => ({ ...prev, syncStatus: 'idle' }));\n          }, 2000);\n          break;\n      }\n    };\n\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    // Listen to service worker messages\n    if (\n      'serviceWorker' in navigator &&\n      navigator.serviceWorker.addEventListener\n    ) {\n      navigator.serviceWorker.addEventListener(\n        'message',\n        handleServiceWorkerMessage\n      );\n    }\n\n    // Check initial state\n    if (!navigator.onLine) {\n      setState((prev) => ({ ...prev, isOnline: false }));\n      setShowIndicator(true);\n    }\n\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n      if (\n        'serviceWorker' in navigator &&\n        navigator.serviceWorker.removeEventListener\n      ) {\n        navigator.serviceWorker.removeEventListener(\n          'message',\n          handleServiceWorkerMessage\n        );\n      }\n    };\n  }, []);\n\n  const handleRetry = () => {\n    window.location.reload();\n  };\n\n  const handleDismiss = () => {\n    setShowIndicator(false);\n  };\n\n  const getIndicatorContent = () => {\n    const { isOnline, syncStatus, pendingRequests } = state;\n\n    if (!isOnline) {\n      return {\n        icon: <WifiOff className=\"w-4 h-4\" />,\n        title: '오프라인 상태',\n        message:\n          pendingRequests > 0\n            ? `${pendingRequests}개 요청이 대기 중입니다`\n            : '일부 기능이 제한될 수 있습니다',\n        bgColor: 'bg-red-500',\n        showActions: true,\n      };\n    }\n\n    switch (syncStatus) {\n      case 'syncing':\n        return {\n          icon: <RefreshCw className=\"w-4 h-4 animate-spin\" />,\n          title: '동기화 중',\n          message: '데이터를 업데이트하고 있습니다...',\n          bgColor: 'bg-blue-500',\n          showActions: false,\n        };\n      case 'success':\n        return {\n          icon: <Wifi className=\"w-4 h-4\" />,\n          title: '온라인 연결됨',\n          message: '모든 기능을 사용할 수 있습니다',\n          bgColor: 'bg-green-500',\n          showActions: false,\n        };\n      case 'error':\n        return {\n          icon: <AlertCircle className=\"w-4 h-4\" />,\n          title: '동기화 오류',\n          message: '일부 데이터 동기화에 실패했습니다',\n          bgColor: 'bg-orange-500',\n          showActions: true,\n        };\n      default:\n        return null;\n    }\n  };\n\n  if (!showIndicator) {\n    return null;\n  }\n\n  const content = getIndicatorContent();\n  if (!content) return null;\n\n  return (\n    <div\n      className={`fixed top-4 right-4 z-50 ${content.bgColor} text-white rounded-lg shadow-lg\n                  p-4 max-w-sm transition-all duration-300 animate-fade-in`}\n      role=\"alert\"\n      aria-live=\"polite\"\n      aria-atomic=\"true\"\n    >\n      <div className=\"flex items-start space-x-3\">\n        <div className=\"flex-shrink-0 mt-0.5\">{content.icon}</div>\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"text-sm font-semibold\">{content.title}</div>\n          <div className=\"text-xs opacity-90 mt-1\">{content.message}</div>\n\n          {/* Progress bar for syncing */}\n          {state.syncStatus === 'syncing' && (\n            <div className=\"mt-2 h-1 bg-white/20 rounded-full overflow-hidden\">\n              <div\n                className=\"h-full bg-white rounded-full transition-all duration-1000 animate-pulse\"\n                style={{ width: '75%' }}\n              />\n            </div>\n          )}\n        </div>\n\n        {/* Close button */}\n        <button\n          onClick={handleDismiss}\n          className=\"flex-shrink-0 text-white/70 hover:text-white transition-colors\"\n          aria-label=\"알림 닫기\"\n        >\n          <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n            <path\n              fillRule=\"evenodd\"\n              d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\"\n              clipRule=\"evenodd\"\n            />\n          </svg>\n        </button>\n      </div>\n\n      {/* Action buttons */}\n      {content.showActions && (\n        <div className=\"mt-3 pt-3 border-t border-white/20 flex space-x-2\">\n          <button\n            onClick={handleRetry}\n            className=\"flex-1 bg-white/10 hover:bg-white/20 text-xs py-2 px-3 rounded\n                       transition-colors duration-200 font-medium\"\n            aria-label=\"연결 상태 다시 확인\"\n          >\n            다시 시도\n          </button>\n          {!state.isOnline && (\n            <button\n              onClick={() => setShowIndicator(false)}\n              className=\"bg-white/10 hover:bg-white/20 text-xs py-2 px-3 rounded\n                         transition-colors duration-200\"\n              aria-label=\"알림 숨기기\"\n            >\n              숨기기\n            </button>\n          )}\n        </div>\n      )}\n    </div>\n  );\n});\n\nOfflineIndicator.displayName = 'OfflineIndicator';\n\nexport default OfflineIndicator;\n"],"names":["OfflineIndicator","memo","state","setState","useState","showIndicator","setShowIndicator","useEffect","handleOnline","prev","handleOffline","handleServiceWorkerMessage","event","type","data","handleRetry","handleDismiss","getIndicatorContent","isOnline","syncStatus","pendingRequests","jsx","WifiOff","RefreshCw","Wifi","AlertCircle","content","jsxs"],"mappings":"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"}