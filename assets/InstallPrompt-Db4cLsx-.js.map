{"version":3,"file":"InstallPrompt-Db4cLsx-.js","sources":["../../src/components/common/InstallPrompt.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Download, X, Smartphone, Monitor } from 'lucide-react';\nimport logger from '../../utils/logger';\n\ninterface BeforeInstallPromptEvent extends Event {\n  prompt: () => Promise<void>;\n  userChoice: Promise<{ outcome: 'accepted' | 'dismissed'; platform: string }>;\n}\n\ninterface InstallPromptProps {\n  onInstall?: () => void;\n  onDismiss?: () => void;\n  className?: string;\n}\n\nconst InstallPrompt: React.FC<InstallPromptProps> = ({\n  onInstall,\n  onDismiss,\n  className = '',\n}) => {\n  const [deferredPrompt, setDeferredPrompt] =\n    useState<BeforeInstallPromptEvent | null>(null);\n  const [isVisible, setIsVisible] = useState(false);\n  const [isInstalling, setIsInstalling] = useState(false);\n  const [deviceType, setDeviceType] = useState<'mobile' | 'desktop'>('desktop');\n\n  useEffect(() => {\n    // Detect device type\n    const isMobile =\n      /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\n        navigator.userAgent\n      );\n    setDeviceType(isMobile ? 'mobile' : 'desktop');\n\n    const handleBeforeInstallPrompt = (e: Event) => {\n      // Prevent the mini-infobar from appearing on mobile\n      e.preventDefault();\n\n      const beforeInstallPromptEvent = e as BeforeInstallPromptEvent;\n      setDeferredPrompt(beforeInstallPromptEvent);\n\n      // Check if user has dismissed the prompt recently\n      const dismissed = localStorage.getItem('install-prompt-dismissed');\n      const dismissedTime = dismissed ? parseInt(dismissed) : 0;\n      const daysSinceDismissed =\n        (Date.now() - dismissedTime) / (1000 * 60 * 60 * 24);\n\n      // Show prompt if not dismissed recently or if it's been more than 7 days\n      if (!dismissed || daysSinceDismissed > 7) {\n        setIsVisible(true);\n      }\n    };\n\n    const handleAppInstalled = () => {\n      // PWA was installed\n      setIsVisible(false);\n      setDeferredPrompt(null);\n\n      if (onInstall) {\n        onInstall();\n      }\n    };\n\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n    window.addEventListener('appinstalled', handleAppInstalled);\n\n    return () => {\n      window.removeEventListener(\n        'beforeinstallprompt',\n        handleBeforeInstallPrompt\n      );\n      window.removeEventListener('appinstalled', handleAppInstalled);\n    };\n  }, [onInstall]);\n\n  const handleInstallClick = async () => {\n    if (!deferredPrompt) {\n      return;\n    }\n\n    setIsInstalling(true);\n\n    try {\n      // Show the install prompt\n      await deferredPrompt.prompt();\n\n      // Wait for the user to respond to the prompt\n      const { outcome } = await deferredPrompt.userChoice;\n\n      if (outcome === 'accepted') {\n        // User accepted the A2HS prompt\n        localStorage.setItem('pwa-install-accepted', 'true');\n        setIsVisible(false);\n        if (onInstall) {\n          onInstall();\n        }\n      } else {\n        // User dismissed the A2HS prompt\n        handleDismiss();\n      }\n\n      setDeferredPrompt(null);\n    } catch (error) {\n      logger.error('Error during installation:', error);\n    } finally {\n      setIsInstalling(false);\n    }\n  };\n\n  const handleDismiss = () => {\n    localStorage.setItem('install-prompt-dismissed', Date.now().toString());\n    setIsVisible(false);\n\n    if (onDismiss) {\n      onDismiss();\n    }\n  };\n\n  const handleRemindLater = () => {\n    // Set reminder for 24 hours later\n    const reminderTime = Date.now() + 24 * 60 * 60 * 1000;\n    localStorage.setItem('install-prompt-dismissed', reminderTime.toString());\n    setIsVisible(false);\n  };\n\n  if (!isVisible || !deferredPrompt) {\n    return null;\n  }\n\n  const deviceIcon =\n    deviceType === 'mobile' ? (\n      <Smartphone className=\"w-6 h-6 text-blue-600 dark:text-blue-400\" />\n    ) : (\n      <Monitor className=\"w-6 h-6 text-blue-600 dark:text-blue-400\" />\n    );\n\n  const deviceText = deviceType === 'mobile' ? '홈 화면' : '데스크톱';\n\n  return (\n    <div\n      className={`fixed bottom-4 left-4 z-50 bg-white dark:bg-gray-800 rounded-lg shadow-xl\n                     p-6 max-w-sm border border-gray-200 dark:border-gray-700\n                     animate-slide-up ${className}`}\n    >\n      <div className=\"flex items-start space-x-4\">\n        <div className=\"flex-shrink-0\">\n          <div className=\"w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center\">\n            {deviceIcon}\n          </div>\n        </div>\n\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-start justify-between\">\n            <h3 className=\"text-sm font-semibold text-gray-900 dark:text-white mb-1\">\n              앱 설치하기\n            </h3>\n            <button\n              onClick={handleDismiss}\n              className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 ml-2\"\n              aria-label=\"닫기\"\n            >\n              <X className=\"w-4 h-4\" />\n            </button>\n          </div>\n\n          <p className=\"text-xs text-gray-600 dark:text-gray-300 mb-4\">\n            에멜무지로를 {deviceText}에 설치하여 더 빠르고 편리하게 이용하세요.\n            오프라인에서도 사용할 수 있습니다.\n          </p>\n\n          {/* Benefits list */}\n          <div className=\"mb-4\">\n            <ul className=\"text-xs text-gray-500 dark:text-gray-400 space-y-1\">\n              <li className=\"flex items-center space-x-2\">\n                <div className=\"w-1 h-1 bg-blue-500 rounded-full\"></div>\n                <span>빠른 실행</span>\n              </li>\n              <li className=\"flex items-center space-x-2\">\n                <div className=\"w-1 h-1 bg-blue-500 rounded-full\"></div>\n                <span>오프라인 사용</span>\n              </li>\n              <li className=\"flex items-center space-x-2\">\n                <div className=\"w-1 h-1 bg-blue-500 rounded-full\"></div>\n                <span>푸시 알림</span>\n              </li>\n            </ul>\n          </div>\n\n          <div className=\"flex space-x-2\">\n            <button\n              onClick={handleInstallClick}\n              disabled={isInstalling}\n              className=\"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400\n                         text-white py-2 px-3 rounded text-xs font-medium\n                         transition-colors duration-200 disabled:cursor-not-allowed\n                         flex items-center justify-center space-x-1\"\n            >\n              <Download className=\"w-3 h-3\" />\n              <span>{isInstalling ? '설치 중...' : '설치'}</span>\n            </button>\n\n            <button\n              onClick={handleRemindLater}\n              className=\"px-3 py-2 text-xs text-gray-600 dark:text-gray-300\n                         hover:text-gray-800 dark:hover:text-gray-100\n                         transition-colors duration-200\"\n            >\n              나중에\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default InstallPrompt;\n"],"names":["InstallPrompt","onInstall","onDismiss","className","deferredPrompt","setDeferredPrompt","useState","isVisible","setIsVisible","isInstalling","setIsInstalling","deviceType","setDeviceType","useEffect","isMobile","handleBeforeInstallPrompt","e","dismissed","dismissedTime","daysSinceDismissed","handleAppInstalled","handleInstallClick","outcome","handleDismiss","error","logger","handleRemindLater","reminderTime","deviceIcon","jsx","Smartphone","Monitor","deviceText","jsxs","X","Download"],"mappings":"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"}