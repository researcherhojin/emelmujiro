import{j as e,X as t,K as a,N as s}from"./ui-vendor-dPCV3Ya0.js";import{r}from"./react-vendor-CcblIELh.js";import{l as i}from"./index-BP7P1ltd.js";import"./i18n-BLYQbxJl.js";const n={}.REACT_APP_VAPID_PUBLIC_KEY||"YOUR_PUBLIC_VAPID_KEY";function o(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),a=window.atob(t),s=new ArrayBuffer(a.length),r=new Uint8Array(s);for(let i=0;i<a.length;++i)r[i]=a.charCodeAt(i);return r}function c(){return"serviceWorker"in navigator&&"PushManager"in window}const l=({onClose:l,className:d=""})=>{const[x,g]=r.useState(!1),[m,h]=r.useState(!1),[u,b]=r.useState(!1),[f,y]=r.useState({blog:!0,contact:!0,system:!0,marketing:!1});r.useEffect(()=>{if(c()){const e=localStorage.getItem("notification-prompt-dismissed"),t=e?parseInt(e):0,a=(Date.now()-t)/864e5;"default"===Notification.permission&&a>3&&g(!0)}const e=localStorage.getItem("notification-settings");if(e)try{y(JSON.parse(e))}catch(t){i.error("Failed to load notification settings:",t)}},[]);const p=(e,t)=>{const a={...f,[e]:t};y(a),localStorage.setItem("notification-settings",JSON.stringify(a))};return c()&&x?u?e.jsx("div",{className:`fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 ${d}`,children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"알림 설정"}),e.jsx("button",{onClick:()=>b(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200","aria-label":"설정 닫기",children:e.jsx(t,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"블로그 업데이트"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"새 글이 게시될 때 알림"})]}),e.jsx("input",{type:"checkbox",checked:f.blog,onChange:e=>p("blog",e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"문의 응답"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"문의에 대한 응답 알림"})]}),e.jsx("input",{type:"checkbox",checked:f.contact,onChange:e=>p("contact",e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"시스템 알림"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"중요한 시스템 업데이트"})]}),e.jsx("input",{type:"checkbox",checked:f.system,onChange:e=>p("system",e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"마케팅 정보"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"프로모션 및 이벤트 정보"})]}),e.jsx("input",{type:"checkbox",checked:f.marketing,onChange:e=>p("marketing",e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"mt-6 flex space-x-3",children:[e.jsx("button",{onClick:()=>{(async e=>{try{if(!(await fetch("/api/notifications/preferences/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw new Error("Failed to save notification settings")}catch(t){i.error("Failed to save notification settings:",t)}})(f),b(!1)},className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg\n                           font-medium transition-colors duration-200",children:"저장"}),e.jsx("button",{onClick:()=>b(!1),className:"flex-1 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700\n                           dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200\n                           py-2 px-4 rounded-lg font-medium transition-colors duration-200",children:"취소"})]})]})})}):e.jsx("div",{className:`fixed bottom-4 right-4 z-50 bg-white dark:bg-gray-800 rounded-lg shadow-xl\n                     p-6 max-w-sm border border-gray-200 dark:border-gray-700 ${d}`,children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center",children:e.jsx(a,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-1",children:"알림 허용하기"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 mb-4",children:"새 블로그 글과 중요한 업데이트를 놓치지 마세요. 언제든지 설정에서 변경할 수 있습니다."}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:async()=>{h(!0);try{await async function(){return c()?"granted"===await Notification.requestPermission():(i.info("Push notifications are not supported in this browser"),!1)}()&&(await async function(){if(!c())throw new Error("Push notifications are not supported");if("granted"!==Notification.permission)throw new Error("Notification permission not granted");try{const e=await navigator.serviceWorker.ready;let t=await e.pushManager.getSubscription();return t||(t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:o(n)})),t}catch(e){throw i.error("Failed to subscribe to push notifications:",e),e}}(),localStorage.setItem("notification-settings",JSON.stringify(f)),g(!1),l&&l())}catch(e){i.error("Failed to enable notifications:",e)}finally{h(!1)}},disabled:m,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400\n                         text-white py-2 px-3 rounded text-xs font-medium\n                         transition-colors duration-200 disabled:cursor-not-allowed",children:m?"설정 중...":"허용"}),e.jsx("button",{onClick:()=>b(!0),className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400\n                         dark:hover:text-gray-200 transition-colors duration-200","aria-label":"알림 설정",children:e.jsx(s,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{localStorage.setItem("notification-prompt-dismissed",Date.now().toString()),g(!1),l&&l()},className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400\n                         dark:hover:text-gray-200 transition-colors duration-200","aria-label":"나중에",children:e.jsx(t,{className:"w-4 h-4"})})]})]})]})}):null};export{l as default};
