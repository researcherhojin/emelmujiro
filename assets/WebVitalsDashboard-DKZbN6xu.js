import{j as e}from"./ui-vendor-CIRe6Htr.js";import{r as t}from"./react-vendor-CcwLiv3B.js";import"./index-2TMfmmtE.js";import"./i18n-CtInlIKh.js";let r=-1;const n=e=>{addEventListener("pageshow",t=>{t.persisted&&(r=t.timeStamp,e(t))},!0)},i=(e,t,r,n)=>{let i,s;return a=>{var o,l;t.value>=0&&(a||n)&&(s=t.value-(i??0),(s||void 0===i)&&(i=t.value,t.delta=s,t.rating=(o=t.value)>(l=r)[1]?"poor":o>l[0]?"needs-improvement":"good",e(t)))}},s=e=>{requestAnimationFrame(()=>requestAnimationFrame(()=>e()))},a=()=>{const e=performance.getEntriesByType("navigation")[0];if(e&&e.responseStart>0&&e.responseStart<performance.now())return e},o=()=>{const e=a();return e?.activationStart??0},l=(e,t=-1)=>{const n=a();let i="navigate";return r>=0?i="back-forward-cache":n&&(document.prerendering||o()>0?i="prerender":document.wasDiscarded?i="restore":n.type&&(i=n.type.replace(/_/g,"-"))),{name:e,value:t,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:i}},d=new WeakMap;function c(e,t){return d.get(e)||d.set(e,new t),d.get(e)}class m{t;i=0;o=[];h(e){if(e.hadRecentInput)return;const t=this.o[0],r=this.o.at(-1);this.i&&t&&r&&e.startTime-r.startTime<1e3&&e.startTime-t.startTime<5e3?(this.i+=e.value,this.o.push(e)):(this.i=e.value,this.o=[e]),this.t?.(e)}}const h=(e,t,r={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(e)){const n=new PerformanceObserver(e=>{Promise.resolve().then(()=>{t(e.getEntries())})});return n.observe({type:e,buffered:!0,...r}),n}}catch{}},u=e=>{let t=!1;return()=>{t||(e(),t=!0)}};let g=-1;const p=new Set,v=()=>"hidden"!==document.visibilityState||document.prerendering?1/0:0,f=e=>{if("hidden"===document.visibilityState){if("visibilitychange"===e.type)for(const e of p)e();isFinite(g)||(g="visibilitychange"===e.type?e.timeStamp:0,removeEventListener("prerenderingchange",f,!0))}},x=()=>{if(g<0){const e=o(),t=document.prerendering?void 0:globalThis.performance.getEntriesByType("visibility-state").filter(t=>"hidden"===t.name&&t.startTime>e)[0]?.startTime;g=t??v(),addEventListener("visibilitychange",f,!0),addEventListener("prerenderingchange",f,!0),n(()=>{setTimeout(()=>{g=v()})})}return{get firstHiddenTime(){return g},onHidden(e){p.add(e)}}},b=e=>{document.prerendering?addEventListener("prerenderingchange",()=>e(),!0):e()},y=[1800,3e3],T=(e,t={})=>{b(()=>{const r=x();let a,d=l("FCP");const c=h("paint",e=>{for(const t of e)"first-contentful-paint"===t.name&&(c.disconnect(),t.startTime<r.firstHiddenTime&&(d.value=Math.max(t.startTime-o(),0),d.entries.push(t),a(!0)))});c&&(a=i(e,d,y,t.reportAllChanges),n(r=>{d=l("FCP"),a=i(e,d,y,t.reportAllChanges),s(()=>{d.value=performance.now()-r.timeStamp,a(!0)})}))})},j=[.1,.25];let C=0,P=1/0,w=0;const N=e=>{for(const t of e)t.interactionId&&(P=Math.min(P,t.interactionId),w=Math.max(w,t.interactionId),C=w?(w-P)/7+1:0)};let L;const S=()=>L?C:performance.interactionCount??0;let F=0;class E{u=[];l=new Map;m;p;v(){F=S(),this.u.length=0,this.l.clear()}L(){const e=Math.min(this.u.length-1,Math.floor((S()-F)/50));return this.u[e]}h(e){if(this.m?.(e),!e.interactionId&&"first-input"!==e.entryType)return;const t=this.u.at(-1);let r=this.l.get(e.interactionId);if(r||this.u.length<10||e.duration>t.P){if(r?e.duration>r.P?(r.entries=[e],r.P=e.duration):e.duration===r.P&&e.startTime===r.entries[0].startTime&&r.entries.push(e):(r={id:e.interactionId,entries:[e],P:e.duration},this.l.set(r.id,r),this.u.push(r)),this.u.sort((e,t)=>t.P-e.P),this.u.length>10){const e=this.u.splice(10);for(const t of e)this.l.delete(t.id)}this.p?.(r)}}}const k=e=>{const t=globalThis.requestIdleCallback||setTimeout;"hidden"===document.visibilityState?e():(e=u(e),addEventListener("visibilitychange",e,{once:!0,capture:!0}),t(()=>{e(),removeEventListener("visibilitychange",e,{capture:!0})}))},I=[200,500],M=(e,t={})=>{if(!globalThis.PerformanceEventTiming||!("interactionId"in PerformanceEventTiming.prototype))return;const r=x();b(()=>{"interactionCount"in performance||L||(L=h("event",N,{type:"event",buffered:!0,durationThreshold:0}));let s,a=l("INP");const o=c(t,E),d=e=>{k(()=>{for(const r of e)o.h(r);const t=o.L();t&&t.P!==a.value&&(a.value=t.P,a.entries=t.entries,s())})},m=h("event",d,{durationThreshold:t.durationThreshold??40});s=i(e,a,I,t.reportAllChanges),m&&(m.observe({type:"first-input",buffered:!0}),r.onHidden(()=>{d(m.takeRecords()),s(!0)}),n(()=>{o.v(),a=l("INP"),s=i(e,a,I,t.reportAllChanges)}))})};class A{m;h(e){this.m?.(e)}}const B=[2500,4e3],O=[800,1800],D=e=>{document.prerendering?b(()=>D(e)):"complete"!==document.readyState?addEventListener("load",()=>D(e),!0):setTimeout(e)},H=(e,t)=>{const r={CLS:{good:.1,poor:.25},FCP:{good:1800,poor:3e3},LCP:{good:2500,poor:4e3},TTFB:{good:800,poor:1800},INP:{good:200,poor:500}}[e];return r?t<=r.good?"good":t>=r.poor?"poor":"needs-improvement":"needs-improvement"},R=e=>({CLS:"Cumulative Layout Shift - Visual stability",FCP:"First Contentful Paint - First render time",LCP:"Largest Contentful Paint - Loading performance",TTFB:"Time to First Byte - Server response time",INP:"Interaction to Next Paint - Overall responsiveness"}[e]||""),V=t.memo(({metric:t})=>{return e.jsxs("div",{className:`p-4 rounded-lg border-2 transition-all hover:shadow-lg ${{good:"bg-green-100 text-green-800 border-green-300","needs-improvement":"bg-yellow-100 text-yellow-800 border-yellow-300",poor:"bg-red-100 text-red-800 border-red-300"}[t.rating]}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:t.name}),e.jsx("span",{className:"text-2xl",children:{good:"‚úÖ","needs-improvement":"‚ö†Ô∏è",poor:"‚ùå"}[t.rating]})]}),e.jsx("div",{className:"text-2xl font-bold mb-2",children:(r=t.name,n=t.value,"CLS"===r?n.toFixed(3):`${Math.round(n)}ms`)}),e.jsx("p",{className:"text-sm opacity-75",children:R(t.name)}),e.jsxs("div",{className:"mt-2 text-xs opacity-50",children:["Measured at: ",new Date(t.timestamp).toLocaleTimeString()]})]});var r,n});V.displayName="MetricCard";const _=t.memo(()=>{const[r,d]=t.useState({CLS:null,FCP:null,LCP:null,TTFB:null,INP:null}),[g,p]=t.useState(!1),v=t.useRef(!1);if(t.useEffect(()=>{if(v.current)return;v.current=!0;const e=e=>{const t={name:e.name,value:e.value,rating:H(e.name,e.value),timestamp:Date.now()};d(r=>({...r,[e.name]:t})),window.gtag&&window.gtag("event","web_vital",{metric_name:e.name,metric_value:e.value,metric_rating:t.rating})};((e,t={})=>{const r=x();T(u(()=>{let a,o=l("CLS",0);const d=c(t,m),u=e=>{for(const t of e)d.h(t);d.i>o.value&&(o.value=d.i,o.entries=d.o,a())},g=h("layout-shift",u);g&&(a=i(e,o,j,t.reportAllChanges),r.onHidden(()=>{u(g.takeRecords()),a(!0)}),n(()=>{d.i=0,o=l("CLS",0),a=i(e,o,j,t.reportAllChanges),s(()=>a())}),setTimeout(a))}))})(e),T(e),((e,t={})=>{b(()=>{const r=x();let a,d=l("LCP");const m=c(t,A),g=e=>{t.reportAllChanges||(e=e.slice(-1));for(const t of e)m.h(t),t.startTime<r.firstHiddenTime&&(d.value=Math.max(t.startTime-o(),0),d.entries=[t],a())},p=h("largest-contentful-paint",g);if(p){a=i(e,d,B,t.reportAllChanges);const r=u(()=>{g(p.takeRecords()),p.disconnect(),a(!0)}),o=e=>{e.isTrusted&&(k(r),removeEventListener(e.type,o,{capture:!0}))};for(const e of["keydown","click","visibilitychange"])addEventListener(e,o,{capture:!0});n(r=>{d=l("LCP"),a=i(e,d,B,t.reportAllChanges),s(()=>{d.value=performance.now()-r.timeStamp,a(!0)})})}})})(e),((e,t={})=>{let r=l("TTFB"),s=i(e,r,O,t.reportAllChanges);D(()=>{const d=a();d&&(r.value=Math.max(d.responseStart-o(),0),r.entries=[d],s(!0),n(()=>{r=l("TTFB",0),s=i(e,r,O,t.reportAllChanges),s(!0)}))})})(e),M(e)},[]),!g)return null;const f=Object.values(r).some(e=>null!==e);return e.jsxs(e.Fragment,{children:[!1,g&&e.jsxs("div",{"data-testid":"web-vitals-dashboard",className:"fixed bottom-20 right-4 z-40 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-2xl max-w-4xl max-h-[80vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Web Vitals Dashboard"}),e.jsx("button",{onClick:()=>p(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200","aria-label":"Close dashboard",children:"‚úï"})]}),f?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(r).map(([t,r])=>r&&e.jsx(V,{metric:r},t))}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx("p",{className:"mb-2",children:"Collecting metrics..."}),e.jsx("p",{className:"text-sm",children:"Navigate around the site to generate metrics"}),e.jsx("p",{className:"text-xs mt-4 opacity-50",children:"Press Ctrl+Shift+V to toggle this dashboard"})]}),f&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Performance Summary"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-green-600",children:"Good: "}),Object.values(r).filter(e=>"good"===e?.rating).length]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-yellow-600",children:"Needs Improvement: "}),Object.values(r).filter(e=>"needs-improvement"===e?.rating).length]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-red-600",children:"Poor: "}),Object.values(r).filter(e=>"poor"===e?.rating).length]})]})]}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("p",{children:"üí° Tip: Metrics are collected as you interact with the page."}),e.jsx("p",{children:"üìà Data is sent to analytics if configured."}),e.jsx("p",{children:"‚å®Ô∏è Press Ctrl+Shift+V to toggle this dashboard."})]})]})]})});_.displayName="WebVitalsDashboard";export{_ as default};
